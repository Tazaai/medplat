# ğŸ§  MedPlat â€“ Clinical AI Platform (Full Project Guide, Proposed Update)

âš ï¸ NOTE: `PROJECT_GUIDE.md` in this repository is a protected, authoritative file.
This proposed guide is submitted as `PROJECT_GUIDE.proposed.md` for review. Do NOT
automatically overwrite `PROJECT_GUIDE.md` â€” create a PR and follow the project's
review policy before applying changes.

---

# ğŸ§  MedPlat â€“ Clinical AI Platform (Full Project Guide, 2025 Edition)

âš ï¸ **SYSTEM CONTEXT FILE â€” Protected Reference**
Used by GitHub Actions, Copilot, and backend logic to define MedPlatâ€™s
core architecture, reasoning model, and global development principles.
**Do not edit automatically** â€” only via authorized expert review.

---

## ğŸ¯ Project Mission

MedPlat is a **dynamic, AI-driven medical case simulator and gamified learning system** designed for **medical students, clinicians, specialists, and researchers**.
It generates realistic, adaptive cases â€” complete with clinical reasoning, differential diagnosis, guideline awareness, and expert-panel commentary â€” entirely **on demand**, using **topics sourced from Firebase (`topics2`)** or user-defined search terms.

> â— MedPlat never uses static or pre-stored case data.
> Every case is dynamically generated by AI based on topic, user context, and region-specific medical guidelines.

---

## ğŸ§© Core Objectives

| Domain                         | Objective                                                                                                                       |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| ğŸ§  **AI Case Generation**      | Produce structured, guideline-aware clinical cases dynamically using GPT-4o and GPT-4o-mini.                                    |
| ğŸ® **Gamification**            | Generate up to 12 adaptive MCQs per case with delayed expert explanations, performance scoring, and progression feedback.       |
| ğŸŒ **Localization**            | Adapt cases, guidelines, and terminology to user region (e.g., EU/DK, US, GCC).                                                 |
| ğŸ‘¥ **Expert Simulation**       | Incorporate reasoning from a 12-role simulated expert panel (internal medicine, surgery, emergency, radiology, pharmacy, etc.). |
| ğŸ§¾ **Educational Rigor**       | Support professional learning, academic teaching, and continuing medical education (CME-grade logic).                           |
| ğŸ” **Infrastructure Security** | Deploy on Google Cloud Run with GitHub Secrets and Artifact Registry â€” no PHI or static data.                                   |
| ğŸ§ª **AI-Safe Development**     | All routes validated locally; CI prevents Firestore writes outside approved collections.                                        |

---

## ğŸ§  Clinical Intelligence Layer

MedPlat includes a **region- and user-aware intelligence layer** that dynamically adjusts each case:

* **Regional adaptation:** integrates sources such as *Danish NBV/NNBV*, *EAU*, *NICE*, and *UpToDate* equivalents.
* **User tiering:** automatically tunes case depth and phrasing for **students**, **doctors**, or **specialists**.
* **Resource sensitivity:** generates alternative management plans for resource-limited settings.
* **Expert reasoning memory:** preserves panel-wide consistency through topic-specific adaptive memory (e.g., prior differential reasoning).

---

## ğŸ‘¥ External Expert-Panel Framework

Every generated case is implicitly reviewed by a **virtual external expert panel** (not visible to end users but used in backend evaluation and QA):

**Panel Composition**

* 1 medical student (user)
* 1 medical doctor (user)
* 3 specialists (across disciplines)
* 2 generalists
* 2 emergency medicine experts
* 1 clinical pharmacist
* 1 field researcher
* 1 radiologist group (1â€“2)
* 1 university professor of medicine
* 1 USMLE expert
* 1 competitor voice (for benchmarking)

**Panel Mandate**

* Provide high-level, scalable feedback for generator improvement.
* Detect missing guideline references, rescue therapies, atypical presentations, and red-flag logic.
* Ensure multidisciplinary, global, and realistic structure across all specialties.
* Recommend *dynamic* rather than hardcoded or static enhancements.

---

## ğŸ—ï¸ Architecture Overview

### Backend

* **Runtime:** Node 18 / Express on Cloud Run
* **Routes:**

  * `/api/topics` â†’ read-only access to Firebase (`topics2`)
  * `/api/dialog` â†’ GPT-based clinician chat interface
  * `/api/gamify` â†’ adaptive MCQ generation & scoring (Level 2)
  * `/api/comment` â†’ case feedback
* **Utilities:**

  * `generate_case_clinical.mjs` â†’ structured case generator
  * `translate_util.mjs` â†’ multilingual support
  * `logUserStep.mjs` â†’ gamification tracking
* **Integrations:** Firebase Admin SDK (read-only topics + logging) + OpenAI API
* **Security:** CORS middleware (env-configurable) + read-only Firestore guards
* **Deployment:** Cloud Run (`process.env.PORT || 8080`)

---

### Data Model

* **topics2** collection stores only `{ id, topic, category, lang }` seeds.
* **No static cases or answers** exist in Firestore â€” all are generated per request.
* Backend fallbacks (`firebaseClient.js`, `openaiClient.js`) keep local tests safe and non-throwing.

---

## ğŸ® Gamification & Educational Design

* **Frontend engine:** `Level2CaseLogic.jsx`
* **Gameplay:** Sequential case-based MCQs (12 per case) with one-click answers, delayed explanations, retry logic, and score logging to Firebase.
* **Scoring:** 3 points = correct ğŸŸ©, 1 = partial ğŸŸ¨, 0 = wrong ğŸŸ¥.
* **Feedback tiers:** â€œMedical Student â†’ Doctor â†’ Specialist â†’ Expert.â€
* **Pedagogy:** Each explanation written as if from an expert panel debating reasoning.
* **Evaluation:** No level selector â€” difficulty dynamically inferred from topic and user performance.

---

## ğŸ“Š AI Output Schema

All generated cases conform to the unified JSON schema:

`{ meta, history, exam, paraclinical, differentials, red_flags, final_diagnosis, pathophysiology, etiology, management, disposition, evidence, teaching, panel_notes }`

This schema enforces:

* Structured completeness
* Explicit reasoning (`why_for` / `why_against`)
* Region-aware management & timing
* Inclusion of hemodynamic profile, test kinetics, imaging escalation, and follow-up/social needs

*(Full schema in `docs/schema_case_output.json`)*

---

## ğŸ’¡ Technical Stack

| Layer      | Technology                                                   |
| ---------- | ------------------------------------------------------------ |
| Frontend   | React (Vite + Tailwind)                                      |
| Backend    | Node 18 / Express                                            |
| Database   | Firebase Firestore (read-only topics2 + logging collections) |
| AI Models  | OpenAI GPT-4o / GPT-4o-mini                                  |
| CI/CD      | GitHub Actions â†’ Cloud Build â†’ Cloud Run                     |
| Auth       | Firebase Auth (optional)                                     |
| Deployment | gcloud builds submit + run deploy                            |
| Secrets    | GitHub â†’ Settings â†’ Actions Secrets                          |
| Tests      | npm --prefix backend test ; Vite build frontend              |

---

## ğŸ” Secret Management

| Secret                 | Description                    |
| ---------------------- | ------------------------------ |
| `OPENAI_API_KEY`       | GPT model access               |
| `GCP_PROJECT`          | GCP project ID                 |
| `GCP_SA_KEY`           | Service Account JSON           |
| `FIREBASE_SERVICE_KEY` | Firebase Admin credentials     |
| `VITE_API_BASE`        | Backend URL for frontend build |
| `CORS_ALLOWED_ORIGINS` | Optional frontend domain list  |

> Production forbids `.env` files â€” secrets injected via CI/CD only.
> Local development uses `.env.local` (ignored by Git).

---

## ğŸ§° Local Development

```bash
npm install
npm install --prefix backend
npm install --prefix frontend
npm --prefix backend test
npm --prefix frontend run build
```

Use environment variables for temporary overrides
(e.g. `SOFT_FAIL_CONNECTIVITY=true` for offline simulation).

---

## ğŸŒ Global Consensus â€” Continuous Improvement

The expert-panel system and developer team agree on these long-term principles:

1. **Dynamic intelligence only** â€” no static text, answers, or images stored.
2. **Clinical realism & region-awareness** â€” always adapt to local guidelines.
3. **Adaptive pedagogy** â€” difficulty inferred, not selected.
4. **Scalable architecture** â€” Firebase topics + OpenAI generation for infinite coverage.
5. **Gamified education** â€” reinforcement through reasoning, not memorization.
6. **Transparent ethics** â€” AI never fabricates references; cites regional societies only.
7. **Continuous self-audit** â€” internal and external panels benchmark MedPlat against global competitors.

---

âœ… **End of Proposed Guide**

This file is a proposed replacement for `PROJECT_GUIDE.md`. To apply:

1. Create a PR that includes this file and a clear review note referencing the protected-file policy.
2. Require an explicit approval from a designated repo owner before merging.

